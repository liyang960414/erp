spring:
  application:
    name: erp
  datasource:
    url: jdbc:postgresql://localhost:5432/erp_db
    username: postgres
    password: liyang960414
    driver-class-name: org.postgresql.Driver
    # HikariCP 连接池配置
    hikari:
      # 连接池最小空闲连接数（建议与最大连接数相同，避免连接创建开销）
      minimum-idle: 10
      # 连接池最大连接数（根据并发量调整，用于支持大批量导入）
      maximum-pool-size: 20
      # 连接最大存活时间（设置为小于数据库/网络超时时间，建议 20-25 分钟）
      max-lifetime: 1200000  # 20分钟（毫秒）
      # 连接空闲超时时间（空闲连接在此时间后被关闭）
      idle-timeout: 600000   # 10分钟（毫秒）
      # 连接获取超时时间（从池中获取连接的最大等待时间）
      connection-timeout: 30000  # 30秒（毫秒）
      # 连接泄漏检测时间（连接在指定时间未关闭将被视为泄漏）
      # 增加到120秒，配合批次处理优化，避免在批次处理时误报泄漏
      leak-detection-threshold: 120000  # 120秒（毫秒）
      # 连接验证查询（PostgreSQL 推荐使用 SELECT 1）
      connection-test-query: SELECT 1
      # 连接验证超时时间
      validation-timeout: 5000  # 5秒（毫秒）
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
  servlet:
    multipart:
      enabled: true
      max-file-size: 200MB
      max-request-size: 200MB
      file-size-threshold: 10MB
  # Redis 配置
  data:
    redis:
      host: localhost
      port: 6379
      password: # 如果有密码，请在此配置
      database: 0
      timeout: 5000ms # 连接超时时间
      lettuce:
        pool:
          max-active: 8 # 最大连接数
          max-idle: 8   # 最大空闲连接数
          min-idle: 0   # 最小空闲连接数
          max-wait: -1ms # 最大等待时间，-1表示无限制
  # 缓存配置
  cache:
    type: redis
    redis:
      time-to-live: 3600000 # 默认缓存过期时间：1小时（毫秒）
      cache-null-values: false # 不缓存空值

server:
  tomcat:
    max-threads: 200
    accept-count: 100
    connection-timeout: 600000 # 10分钟连接超时
    max-connections: 10000
    max-swallow-size: 209715200 # 200MB (字节)
    max-http-form-post-size: 209715200

jwt:
  secret: mySecretKeyForJWTTokenGenerationAndValidationMustBeAtLeast256Bits
  expiration: 86400000 # 24小时

logging:
  level:
    root: INFO
    com.sambound.erp: DEBUG
    com.zaxxer.hikari: INFO
  file:
    name: ./target/logs/erp.log
  logback:
    rollingpolicy:
      max-file-size: 2MB
      max-history: 10
      total-size-cap: 100MB
      file-name-pattern: ${logging.file.name}.%d{yyyy-MM-dd}.%i

# 添加以下配置
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: always
